<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Charity Platform</title>
    <link href="./src/output.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>

  <body class="bg-gray-50 text-gray-800">
    <!-- Navbar -->
    <nav class="bg-white shadow-sm">
      <div
        class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center"
      >
        <h1 class="text-2xl font-bold text-indigo-600">CharityConnect</h1>
        <div class="space-x-4">
          <a href="login.html" class="text-gray-600 hover:text-indigo-600"
            >Login</a
          >
          <a
            href="register.html"
            class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
          >
            Register
          </a>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section
      class="bg-linear-to-r from-indigo-600 to-purple-600 text-white py-20"
    >
      <div class="max-w-4xl mx-auto text-center px-6">
        <h2 class="text-4xl font-bold mb-4">Make a Difference Today</h2>
        <p class="text-lg mb-8 text-indigo-100">
          Support verified charities and bring real change to the world.
        </p>
        <a
          href="#charities"
          class="bg-white text-indigo-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition"
        >
          Explore Charities
        </a>
      </div>
    </section>

    <!-- Charities Section -->
    <section id="charities" class="max-w-7xl mx-auto px-6 py-16">
      <div class="flex justify-between items-center mb-8">
        <h3 class="text-2xl font-bold">Active Charities</h3>
        <span class="text-sm text-gray-500">Verified Organizations</span>
      </div>

      <div id="charityList" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Dynamic charity cards will be injected here -->
      </div>
    </section>

    <!-- Top Donors Section -->
    <section class="bg-white py-16 border-t">
      <div class="max-w-4xl mx-auto px-6">
        <h3 class="text-2xl font-bold mb-8 text-center">Top 5 Donors</h3>

        <div id="topDonors" class="space-y-4">
          <!-- Dynamic donor list -->
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-8 mt-10">
      <div class="max-w-7xl mx-auto px-6 text-center">
        <p class="text-sm">© 2026 CharityConnect. All rights reserved.</p>
      </div>
    </footer>

    <!-- Script Section -->
    <script>
      async function loadCharities() {
        try {
          const res = await axios.get("/api/charities");
          console.log(res);
          const data = res.data.data;
          const container = document.getElementById("charityList");

          data.forEach((c) => {
            const collected = c.collected_amount ? c.collected_amount : 0;
            const goal = c.goal_amount ? c.goal_amount : 1;

            const percentage = Math.min(
              Math.round((collected / goal) * 100),
              100,
            );

            container.innerHTML += `
    <div class="bg-white shadow-md rounded-xl p-6 hover:shadow-lg transition flex flex-col justify-between">

      <div>
        <h4 class="text-lg font-semibold mb-2">${c.name}</h4>

        <p class="text-gray-600 text-sm mb-4">
          ${c.description || "No description available."}
        </p>

        <div class="mb-2 flex justify-between text-sm">
          <span class="font-medium text-gray-700">
            ₹${collected} raised
          </span>
          <span class="text-gray-500">
            Goal ₹${goal}
          </span>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
          <div 
            class="bg-indigo-600 h-3 rounded-full transition-all duration-500"
            style="width: ${percentage}%">
          </div>
        </div>

        <div class="mt-2 text-right text-xs text-gray-500">
          ${percentage}% funded
        </div>
      </div>

      <!-- Donate Button -->
      <button 
        onclick="redirectToLogin()" 
        class="mt-6 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition w-fit">
        Donate Now
      </button>

    </div>
  `;
          });
        } catch (err) {
          console.error(err);
        }
      }
      function redirectToLogin() {
        window.location.href = "login.html";
      }
      async function loadTopDonors() {
        try {
          const res = await axios.get(
            "http://localhost:3000/api/donations/top",
          );

          const container = document.getElementById("topDonors");

          res.data.forEach((d, index) => {
            container.innerHTML += `
            <div class="flex justify-between bg-gray-50 p-4 rounded-lg shadow-sm">
              <span class="font-medium">${index + 1}. ${d.name}</span>
              <span class="text-indigo-600 font-semibold">
                ₹${d.totalAmount}
              </span>
            </div>
          `;
          });
        } catch (err) {
          console.error(err);
        }
      }

      loadCharities();
      loadTopDonors();
    </script>
  </body>
</html>
